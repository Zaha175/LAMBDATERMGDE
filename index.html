<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aktualisierte Λ(z) Dynamik mit DESI-Fits</title>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE',
                        heading: '#0A2472',
                        accent1: '#5D9CDE',
                        accent2: '#DE5D9C',
                        accent3: '#9CDE5D',
                        lightAccent: '#f0f4ff',
                        darkAccent: '#192339',
                        temperature: '#8b5cf6',
                        entropy: '#db2777',
                        pantheon: '#ef4444',
                        union3: '#f97316',  
                        desy5: '#eab308',
                        phantom: '#ef4444',
                        quintessence: '#3b82f6',
                        cosmological: '#10b981'
                    },
                },
            },
        }

        // Check for dark mode preference
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });
    </script>
    <style>
        .dark {
            color-scheme: dark;
        }
        .dark .math {
            color: #e2e8f0;
        }
        .equation-container {
            position: relative;
            margin: 1rem 0;
            padding: 1rem;
            background: rgba(93, 156, 222, 0.05);
            border-left: 3px solid #5D9CDE;
            border-radius: 0.5rem;
        }
        .equation-content {
             padding-right: 2rem;
        }
        .chart-container {
            position: relative;
            height: 60vh;
            width: 100%;
            margin-bottom: 1rem;
        }
        .small-chart-container {
            position: relative;
            height: 30vh;
            width: 100%;
            margin-bottom: 1rem;
        }
        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            height: 6px;
            background: #e2e8f0;
            border-radius: 5px;
            outline: none;
            margin: 10px 0;
        }
        .dark input[type="range"] {
            background: #4b5563;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #5D5CDE;
            cursor: pointer;
            transition: background 0.15s ease;
        }
        .dark input[type="range"]::-webkit-slider-thumb {
            background: #93c5fd;
        }
        input[type="range"]::-moz-range-thumb {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #5D5CDE;
            cursor: pointer;
            border: none;
            transition: background 0.15s ease;
        }
        #loading-bar {
            position: fixed;
            top: 0;
            left: 0;
            width: 0%;
            height: 4px;
            background: linear-gradient(to right, #5D5CDE, #DE5D9C);
            z-index: 9999;
            transition: width 0.3s ease;
        }
        .data-point {
            display: inline-block;
            padding: 0.2rem 0.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
        }
        .phantom-region {
            background-color: rgba(239, 68, 68, 0.15);
        }
        .dark .phantom-region {
            background-color: rgba(239, 68, 68, 0.25);
        }
        .quintessence-region {
            background-color: rgba(59, 130, 246, 0.15);
        }
        .dark .quintessence-region {
            background-color: rgba(59, 130, 246, 0.25);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-white to-lightAccent dark:from-gray-900 dark:to-darkAccent text-gray-800 dark:text-gray-100 transition-colors duration-200">
    <div id="loading-bar"></div>
    
    <div class="container mx-auto px-4 py-8 max-w-7xl shadow-lg rounded-lg bg-white/80 dark:bg-gray-900/80 backdrop-blur-sm">
        <header class="flex flex-col md:flex-row justify-between items-center mb-8 relative">
            <div class="absolute -top-8 left-0 right-0 h-2 bg-gradient-to-r from-accent1 via-accent2 to-accent3 rounded-full"></div>
            <div class="text-center md:text-left">
                <h1 class="text-2xl md:text-3xl font-bold mb-2 bg-clip-text text-transparent bg-gradient-to-r from-heading to-accent1 dark:from-accent1 dark:to-accent2">Λ(z) Dynamik mit aktualisierten DESI-Fits</h1>
                <h2 class="text-lg md:text-xl font-semibold text-heading dark:text-accent1">GDE-Modell und neue Phantom-Dynamik</h2>
            </div>
            <button id="darkModeToggle" class="mt-4 md:mt-0 px-4 py-2 rounded-full bg-heading text-white dark:bg-accent1 hover:bg-opacity-90 transition-colors duration-200">
                <span id="darkModeIcon">🌙</span> <span id="darkModeText">Dark Mode</span>
            </button>
        </header>

        <div class="bg-blue-50 dark:bg-blue-900/30 p-4 rounded-lg mb-8">
            <h3 class="text-xl font-semibold mb-2 text-blue-800 dark:text-blue-300">Neue DESI-Fits (Page 64, Appendix A)</h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-2">
                <div class="p-3 bg-pantheon/10 rounded-lg border-l-4 border-pantheon">
                    <p class="font-semibold text-pantheon">DESI+SDSS+CMB+PantheonPlus</p>
                    <p class="mt-1">w<sub>0</sub> = −0.855 ± 0.060</p>
                    <p>w<sub>a</sub> = −0.60<span class="text-sm">−0.23<sup>+0.26</sup></span></p>
                    <p class="mt-2 font-bold">w(z=0.5) ≈ −1.06</p>
                </div>
                <div class="p-3 bg-union3/10 rounded-lg border-l-4 border-union3">
                    <p class="font-semibold text-union3">DESI+SDSS+CMB+Union3</p>
                    <p class="mt-1">w<sub>0</sub> = −0.692 ± 0.095</p>
                    <p>w<sub>a</sub> = −1.06<span class="text-sm">−0.31<sup>+0.36</sup></span></p>
                    <p class="mt-2 font-bold">w(z=0.5) ≈ −1.05</p>
                </div>
                <div class="p-3 bg-desy5/10 rounded-lg border-l-4 border-desy5">
                    <p class="font-semibold text-desy5">DESI+SDSS+CMB+DESY5</p>
                    <p class="mt-1">w<sub>0</sub> = −0.761 ± 0.064</p>
                    <p>w<sub>a</sub> = −0.88<span class="text-sm">−0.25<sup>+0.29</sup></span></p>
                    <p class="mt-2 font-bold">w(z=0.5) ≈ −1.05</p>
                </div>
            </div>
            <p class="text-sm italic mt-3">
                Hinweis: w(z=0.5) wurde mit der Formel w(z=0.5) = w<sub>0</sub> + w<sub>a</sub>/3 berechnet.
            </p>
        </div>

        <section class="bg-white/80 dark:bg-gray-800/80 p-6 rounded-xl shadow-lg mb-10">
            <h3 class="text-xl font-semibold mb-6 text-indigo-600 dark:text-indigo-400 flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
                </svg>
                Angepasste Parameter für die DESI-Fits
            </h3>
            
            <div class="equation-container bg-blue-50/80 dark:bg-blue-900/20">
                <div class="equation-content text-center">
                    \[ \Lambda(z) = \Lambda_0 \cdot \left( \frac{T_0}{T_{\mathrm{CMB}}(z)} \right)^{\alpha(z)} \cdot \left(1 + \beta \cdot \frac{S_{\mathrm{Struktur}}(z)}{S_{\mathrm{Struktur}}(0)} \right) \]
                </div>
            </div>
            
            <div class="mt-4 grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="bg-indigo-50 dark:bg-indigo-900/20 p-3 rounded-lg">
                    <div class="flex justify-between mb-1">
                        <h4 class="font-semibold text-indigo-700 dark:text-indigo-300">α₀</h4>
                        <div class="text-sm text-indigo-600 dark:text-indigo-200">
                            <span class="line-through">-0.57</span> → <span class="font-bold">-0.65</span>
                        </div>
                    </div>
                    <p class="text-sm">
                        Basis-Exponent der thermodynamischen Kopplung
                    </p>
                </div>
                <div class="bg-indigo-50 dark:bg-indigo-900/20 p-3 rounded-lg">
                    <div class="flex justify-between mb-1">
                        <h4 class="font-semibold text-indigo-700 dark:text-indigo-300">A</h4>
                        <div class="text-sm text-indigo-600 dark:text-indigo-200">
                            <span class="line-through">1.20</span> → <span class="font-bold">1.10</span>
                        </div>
                    </div>
                    <p class="text-sm">
                        Amplitudenfaktor der α(z)-Funktion
                    </p>
                </div>
                <div class="bg-indigo-50 dark:bg-indigo-900/20 p-3 rounded-lg">
                    <div class="flex justify-between mb-1">
                        <h4 class="font-semibold text-indigo-700 dark:text-indigo-300">z*</h4>
                        <div class="text-sm text-indigo-600 dark:text-indigo-200">
                            <span class="line-through">0.69</span> → <span class="font-bold">0.70</span>
                        </div>
                    </div>
                    <p class="text-sm">
                        Übergangszone zwischen kosmischen Epochen
                    </p>
                </div>
                <div class="bg-indigo-50 dark:bg-indigo-900/20 p-3 rounded-lg">
                    <div class="flex justify-between mb-1">
                        <h4 class="font-semibold text-indigo-700 dark:text-indigo-300">β</h4>
                        <div class="text-sm text-indigo-600 dark:text-indigo-200">
                            <span class="line-through">0.048</span> → <span class="font-bold">0.040</span>
                        </div>
                    </div>
                    <p class="text-sm">
                        Kopplungsparameter an die Strukturentropie
                    </p>
                </div>
            </div>
            
            <div class="mt-4 p-3 bg-primary-50 dark:bg-primary-900/20 rounded-lg border-l-4 border-primary">
                <p>
                    <span class="font-semibold">Physikalische Bedeutung der Parameteränderungen:</span> Die aktualisierten DESI-Fits zeigen 
                    bei z=0.5 einen Wert von w(z=0.5) ≈ -1.05, was im <span class="bg-phantom/20 px-1 py-0.5 rounded">Phantom-Bereich</span> 
                    (w < -1) liegt, im Gegensatz zum früheren Wert von -0.84 im <span class="bg-quintessence/20 px-1 py-0.5 rounded">Quintessenz-Bereich</span> 
                    (w > -1). Das erfordert angepasste Parameter im GDE-Modell.
                </p>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-6">
                <div class="p-4 bg-white dark:bg-gray-700 rounded-lg shadow border-l-4 border-primary">
                    <h4 class="text-lg font-semibold text-indigo-600 dark:text-indigo-300 mb-2">
                        Übergangszone z<sub>*</sub>
                    </h4>
                    <p class="text-sm mb-2">
                        Legt fest, wann sich α(z) ändert:
                    </p>
                    <input type="range" id="z_star" min="0.4" max="0.8" step="0.01" value="0.70" class="w-full">
                    <div class="flex justify-between text-xs text-gray-500 dark:text-gray-400">
                        <span>Früher (0.4)</span>
                        <span id="z_star_value" class="font-semibold text-black dark:text-white">z* = 0.70</span>
                        <span>Später (0.8)</span>
                    </div>
                </div>
                
                <div class="p-4 bg-white dark:bg-gray-700 rounded-lg shadow border-l-4 border-primary">
                    <h4 class="text-lg font-semibold text-indigo-600 dark:text-indigo-300 mb-2">
                        Basis-Exponent α<sub>0</sub>
                    </h4>
                    <p class="text-sm mb-2">
                        Basiswert des Temperaturexponenten:
                    </p>
                    <input type="range" id="alpha_0" min="-1.0" max="0.0" step="0.05" value="-0.65" class="w-full">
                    <div class="flex justify-between text-xs text-gray-500 dark:text-gray-400">
                        <span>Stärker (-1.0)</span>
                        <span id="alpha_0_value" class="font-semibold text-black dark:text-white">α₀ = -0.65</span>
                        <span>Schwächer (0.0)</span>
                    </div>
                </div>
                
                <div class="p-4 bg-white dark:bg-gray-700 rounded-lg shadow border-l-4 border-primary">
                    <h4 class="text-lg font-semibold text-indigo-600 dark:text-indigo-300 mb-2">
                        Amplitudenfaktor A
                    </h4>
                    <p class="text-sm mb-2">
                        Stärke des Übergangs bei z<sub>*</sub>:
                    </p>
                    <input type="range" id="alpha_amp" min="0.5" max="1.5" step="0.05" value="1.10" class="w-full">
                    <div class="flex justify-between text-xs text-gray-500 dark:text-gray-400">
                        <span>Schwach (0.5)</span>
                        <span id="alpha_amp_value" class="font-semibold text-black dark:text-white">A = 1.10</span>
                        <span>Stark (1.5)</span>
                    </div>
                </div>
            </div>
            
            <div class="mt-4">
                <div class="p-3 bg-gray-50 dark:bg-gray-800 rounded-lg">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center">
                            <span class="font-semibold mr-2">β-Parameter:</span>
                            <input type="range" id="beta" min="0.01" max="0.06" step="0.005" value="0.040" class="w-48">
                        </div>
                        <span id="beta_value" class="font-semibold">β = 0.040</span>
                    </div>
                </div>
            </div>
            
            <div class="mt-4 flex justify-center space-x-4">
                <button id="resetParams" class="px-3 py-1 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-full hover:bg-gray-300 dark:hover:bg-gray-600 text-sm flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                    </svg>
                    Optimale Parameter für DESI-Fits
                </button>
            </div>
        </section>

        <section class="bg-white/80 dark:bg-gray-800/80 p-6 rounded-xl shadow-lg mb-10">
            <h3 class="text-xl font-semibold mb-4 text-center text-indigo-600 dark:text-indigo-400 flex items-center justify-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                </svg>
                w(z) Dynamik mit DESI-Messungen
            </h3>
            
            <div class="chart-container mb-6">
                <canvas id="WzChart"></canvas>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="bg-primary-50 dark:bg-primary-900/20 p-4 rounded-lg border-l-4 border-primary">
                    <h4 class="text-lg font-semibold mb-3 text-primary dark:text-blue-300">Von Quintessenz zu Phantom</h4>
                    <ul class="space-y-2 list-disc pl-5">
                        <li><strong>Frühere Daten:</strong> w(z=0.5) ≈ -0.84 (quintessenz-artig, w > -1)</li>
                        <li><strong>Neue DESI-Fits:</strong> w(z=0.5) ≈ -1.05 (phantom-artig, w < -1)</li>
                        <li><strong>Bedeutung:</strong> Bei z=0.5 steigt Λ(z), was zu einer stärkeren kosmischen Beschleunigung führt</li>
                        <li><strong>GDE-Modell:</strong> Die Dynamik bleibt bestehen, mit einer komplexeren w(z)-Kurve, die bei z=0.5 eine Phantom-Phase zeigt</li>
                    </ul>
                </div>
                
                <div class="bg-indigo-50 dark:bg-indigo-900/20 p-4 rounded-lg border-l-4 border-indigo-500">
                    <h4 class="text-lg font-semibold mb-3 text-indigo-600 dark:text-indigo-300">Parameteränderungen</h4>
                    <ul class="space-y-2 list-disc pl-5">
                        <li><strong>Negativerer α₀:</strong> Verstärkt den Einfluss der Temperatur, macht Λ(z) steiler in der späten Epoche</li>
                        <li><strong>Kleineres A:</strong> Etwas sanfterer Übergang bei z*</li>
                        <li><strong>Früheres z*:</strong> Übergang erfolgt bereits bei z=0.70 statt 0.69</li>
                        <li><strong>Reduziertes β:</strong> Geringerer Einfluss der Strukturentropie, was die Temperatur-Dynamik in den Vordergrund stellt</li>
                    </ul>
                </div>
            </div>
        </section>

        <section class="bg-white/80 dark:bg-gray-800/80 p-6 rounded-xl shadow-lg mb-10">
            <h3 class="text-xl font-semibold mb-6 text-indigo-600 dark:text-indigo-400 flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
                </svg>
                Dynamischer Λ(z)-Term und seine Evolution
            </h3>
            
            <div class="chart-container mb-6">
                <canvas id="LambdaMainChart"></canvas>
            </div>
            
            <div class="p-4 bg-gradient-to-r from-white to-lightAccent dark:from-gray-900 dark:to-darkAccent rounded-lg">
                <h4 class="text-lg font-semibold mb-3 text-primary dark:text-blue-300">Physikalische Auswirkungen auf den Lambda-Term</h4>
                <p class="mb-3">
                    Mit den angepassten Parametern (α₀ = -0.65, A = 1.10, z* = 0.70, β = 0.040) zeigt der Lambda-Term folgende Eigenschaften:
                </p>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <ul class="space-y-2 list-disc pl-5">
                        <li><strong>Steilere Abnahme:</strong> Λ(z) fällt schneller mit steigendem z im Bereich z > z*</li>
                        <li><strong>Flacherer Anstieg:</strong> Im Bereich z < 0 (Zukunft) steigt Λ(z) an, aber weniger steil als zuvor</li>
                        <li><strong>Kritischer Bereich:</strong> Bei z ≈ 0.5 hat Λ(z) eine positive Steigung, was zum phantom-artigen Verhalten (w < -1) führt</li>
                    </ul>
                    <ul class="space-y-2 list-disc pl-5">
                        <li><strong>Konsistenz mit DESI:</strong> Das Modell kann mit den neuen Parametern die DESI-Daten konsistent erklären</li>
                        <li><strong>Thermodynamische Interpretation:</strong> Die Temperaturkopplung dominiert stärker über die Strukturentropie</li>
                        <li><strong>Langzeitverhalten:</strong> Die phantom-artige Phase könnte auf langfristige kosmologische Konsequenzen hindeuten</li>
                    </ul>
                </div>
            </div>
        </section>

        <section class="bg-white/80 dark:bg-gray-800/80 p-6 rounded-xl shadow-lg mb-10">
            <h3 class="text-xl font-semibold mb-6 text-indigo-600 dark:text-indigo-400 flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
                </svg>
                Vergleich mit allen DESI-Fits
            </h3>
            
            <div class="chart-container">
                <canvas id="CompareFitsChart"></canvas>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6">
                <div class="p-4 bg-phanteon/5 dark:bg-phanteon/10 rounded-lg border-l-4 border-phanteon">
                    <h4 class="text-lg font-semibold mb-3 text-pantheon">CPL-Modell aus DESI-Fits</h4>
                    <div class="equation-container bg-white/70 dark:bg-gray-900/70">
                        <div class="equation-content text-center">
                            \[ w(z) = w_0 + w_a \frac{z}{1+z} \]
                        </div>
                    </div>
                    <p class="mt-3">
                        Das CPL-Modell (Chevallier-Polarski-Linder) ist ein phänomenologisches Modell, das w(z) parametrisiert.
                        Im Gegensatz dazu bietet das GDE-Modell eine <strong>physikalische Grundlage</strong> für die Dynamik von w(z)
                        durch thermodynamische Kopplungen.
                    </p>
                </div>
                
                <div class="p-4 bg-primary/5 dark:bg-primary/10 rounded-lg border-l-4 border-primary">
                    <h4 class="text-lg font-semibold mb-3 text-primary">GDE vs. CPL</h4>
                    <ul class="space-y-2 list-disc pl-5">
                        <li><strong>Flexibilität:</strong> Das GDE-Modell kann die DESI-Kurve mit wenigen physikalisch motivierten Parametern reproduzieren</li>
                        <li><strong>Physikalische Kopplung:</strong> Dynamik entsteht durch thermodynamische Verbindung zu realen kosmischen Prozessen</li>
                        <li><strong>Vorhersagekraft:</strong> GDE erlaubt Vorhersagen für z-Bereiche außerhalb direkter Messungen</li>
                        <li><strong>Signifikanz:</strong> Die vom GDE-Modell natürlich generierte Dynamik passt zu den 2.5-3.9σ Abweichungen vom ΛCDM-Modell in den DESI-Daten</li>
                    </ul>
                </div>
            </div>
        </section>

        <div class="text-center mt-8 p-4 bg-gradient-to-r from-white to-lightAccent dark:from-gray-900 dark:to-darkAccent rounded-lg shadow">
            <h3 class="text-xl font-semibold mb-3 text-primary">Zusammenfassung</h3>
            <p class="text-gray-700 dark:text-gray-300">
                Das GDE-Modell kann mit angepassten Parametern (α₀ = -0.65, A = 1.10, z* = 0.70, β = 0.040) die neuesten DESI-Fits 
                reproduzieren, die eine phantom-artige Dunkle Energie (w < -1) bei z=0.5 nahelegen. Diese Anpassung betont die 
                Flexibilität des thermodynamischen Ansatzes und verleiht der beobachteten Dynamik eine physikalische Grundlage.
            </p>
            <p class="text-sm mt-4 text-gray-600 dark:text-gray-400">
                <span id="generationDate" class="font-semibold"></span>
            </p>
        </div>

        <footer class="mt-12 pt-8 border-t border-gray-300 dark:border-gray-700 italic text-center bg-gradient-to-br from-lightAccent to-white dark:from-darkAccent dark:to-gray-900 p-6 rounded-lg shadow-md">
            <p class="text-accent2 dark:text-accent3 font-serif">"Die beste Theorie ist nicht die komplizierteste, sondern die, die das Unerwartete einfach erklärt." <span class="block mt-2 text-sm">-- Gabriel ϕ</span></p>
        </footer>
    </div>

    <script>
        // --- Data Generation based on GDE Model ---
        function generateData() {
            // Generate a detailed redshift range with higher resolution
            const zRange = [];
            const zStep = 0.02; // Higher resolution (was 0.05)
            for (let z = -0.5; z <= 3; z += zStep) {
                zRange.push(parseFloat(z.toFixed(2)));
            }

            // Model parameters (updated version for phantom dynamics)
            const modelParams = {
                z_star: 0.70,  // Updated from 0.60
                alpha_0: -0.65, // Down from -0.57
                alpha_amp: 1.10, // Down from 1.20
                beta: 0.040  // Down from 0.048
            };

            // Calculate α(z) 
            const alpha_z = zRange.map(z => {
                return modelParams.alpha_0 + modelParams.alpha_amp * Math.tanh(2 * (z - modelParams.z_star));
            });

            // Model for structure entropy ratio S_rel(z)
            const zData = [0.0, 0.5, 1.0, 2.0, 3.0];
            const sRelData = [1.0, 0.339, 0.156, 0.053, 0.02];
            
            // Interpolate S_rel
            const S_rel = zRange.map(z => {
                if (z < 0) return 1.0;
                if (z > 3) return 0.02;
                
                let i = 0;
                while (i < zData.length - 1 && zData[i + 1] < z) i++;
                
                if (i === zData.length - 1) return sRelData[i];
                if (z === zData[i]) return sRelData[i];
                
                const t = (z - zData[i]) / (zData[i + 1] - zData[i]);
                return sRelData[i] + t * (sRelData[i + 1] - sRelData[i]);
            });
            
            // Calculate temperature term
            const tempTerm = zRange.map((z, i) => {
                return Math.pow(1/(1+z), alpha_z[i]);
            });
            
            // Calculate entropy term
            const entropyTerm = zRange.map((z, i) => {
                return 1 + modelParams.beta * S_rel[i];
            });
            
            // Calculate Lambda(z)/Lambda₀
            const Lambda_ratio = zRange.map((z, i) => {
                return tempTerm[i] * entropyTerm[i];
            });
            
            // ΛCDM reference
            const Lambda_LCDM = Array(zRange.length).fill(1.0);
            
            // Calculate dlnLambda/dz for w(z)
            const dlnLambda_dz = zRange.map((z, i, arr) => {
                if (i === 0) {
                    return Math.log(Lambda_ratio[i+1] / Lambda_ratio[i]) / zStep;
                } else if (i === arr.length - 1) {
                    return Math.log(Lambda_ratio[i] / Lambda_ratio[i-1]) / zStep;
                } else {
                    return Math.log(Lambda_ratio[i+1] / Lambda_ratio[i-1]) / (2 * zStep);
                }
            });
            
            // Calculate w(z) 
            const w_z = zRange.map((z, i) => {
                return -1 + (1+z)/3 * dlnLambda_dz[i];
            });
            
            // w(z) for ΛCDM
            const w_z_LCDM = Array(zRange.length).fill(-1);
            
            // Calculate CPL model for DESI fits
            // w(z) = w0 + wa*z/(1+z)
            
            // DESI+SDSS+CMB+PantheonPlus: w0 = -0.855 ± 0.060, wa = -0.60
            const w_z_pantheon = zRange.map(z => {
                return -0.855 + (-0.60) * z / (1 + z);
            });
            
            // DESI+SDSS+CMB+Union3: w0 = -0.692 ± 0.095, wa = -1.06
            const w_z_union3 = zRange.map(z => {
                return -0.692 + (-1.06) * z / (1 + z);
            });
            
            // DESI+SDSS+CMB+DESY5: w0 = -0.761 ± 0.064, wa = -0.88
            const w_z_desy5 = zRange.map(z => {
                return -0.761 + (-0.88) * z / (1 + z);
            });

            return {
                z: zRange,
                alpha_z,
                S_rel,
                beta: modelParams.beta,
                tempTerm,
                entropyTerm,
                Lambda_ratio,
                Lambda_LCDM,
                w_z,
                w_z_LCDM,
                w_z_pantheon,
                w_z_union3,
                w_z_desy5,
                DESI_points: [
                    { z: 0.5, w: -1.05, label: "DESI+SDSS+CMB+Union3" },
                    { z: 0.5, w: -1.05, label: "DESI+SDSS+CMB+DESY5" },
                    { z: 0.5, w: -1.06, label: "DESI+SDSS+CMB+PantheonPlus" },
                    { z: 0.5, w: -0.84, label: "Frühere Schätzung" }
                ]
            };
        }
        
        // Generate the data
        const html_data = generateData();
        
        // Model parameters that can be adjusted by the user
        let modelParams = {
            z_star: 0.70,
            alpha_0: -0.65,
            alpha_amp: 1.10,
            beta: 0.040
        };
        
        // Chart instances
        let wzChartInstance, lambdaMainChartInstance, compareFitsChartInstance;
        
        // Function to recompute the data based on adjusted parameters
        function recomputeData() {
            // Get current parameters
            const z_star = modelParams.z_star;
            const alpha_0 = modelParams.alpha_0;
            const alpha_amp = modelParams.alpha_amp;
            const beta = modelParams.beta;
            
            // Recalculate α(z)
            const alpha_z = html_data.z.map(z => {
                return alpha_0 + alpha_amp * Math.tanh(2 * (z - z_star));
            });
            
            // Recalculate temperature term
            const tempTerm = html_data.z.map((z, i) => {
                return Math.pow(1/(1+z), alpha_z[i]);
            });
            
            // Recalculate entropy term
            const entropyTerm = html_data.z.map((z, i) => {
                return 1 + beta * html_data.S_rel[i];
            });
            
            // Recalculate Lambda_ratio
            const Lambda_ratio = html_data.z.map((z, i) => {
                return tempTerm[i] * entropyTerm[i];
            });
            
            // Recalculate dlnLambda_dz
            const zStep = html_data.z[1] - html_data.z[0];
            const dlnLambda_dz = html_data.z.map((z, i, arr) => {
                if (i === 0) {
                    return Math.log(Lambda_ratio[i+1] / Lambda_ratio[i]) / zStep;
                } else if (i === arr.length - 1) {
                    return Math.log(Lambda_ratio[i] / Lambda_ratio[i-1]) / zStep;
                } else {
                    return Math.log(Lambda_ratio[i+1] / Lambda_ratio[i-1]) / (2 * zStep);
                }
            });
            
            // Recalculate w(z)
            const w_z = html_data.z.map((z, i) => {
                return -1 + (1+z)/3 * dlnLambda_dz[i];
            });
            
            // Update data
            html_data.alpha_z = alpha_z;
            html_data.tempTerm = tempTerm;
            html_data.entropyTerm = entropyTerm;
            html_data.Lambda_ratio = Lambda_ratio;
            html_data.w_z = w_z;
            
            // Update charts
            renderCharts();
        }
        
        // Function to create chart options
        function getChartOptions(titleText, yLabel) {
            const isDarkMode = document.documentElement.classList.contains('dark');
            const textColor = isDarkMode ? '#f3f4f6' : '#1f2937';
            const gridColor = isDarkMode ? 'rgba(209, 213, 219, 0.2)' : 'rgba(55, 65, 81, 0.2)';
            
            return {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'top',
                        labels: { 
                            color: textColor,
                            font: { size: 11 }
                        }
                    },
                    tooltip: {
                        mode: 'index',
                        intersect: false
                    },
                    title: {
                        display: false,
                        text: titleText
                    }
                },
                scales: {
                    x: {
                        title: {
                            display: true,
                            text: 'Rotverschiebung z',
                            color: textColor,
                            font: { weight: 'bold', size: 12 }
                        },
                        ticks: { 
                            color: textColor 
                        },
                        grid: { 
                            color: gridColor
                        }
                    },
                    y: {
                        title: {
                            display: true,
                            text: yLabel,
                            color: textColor,
                            font: { weight: 'bold', size: 12 }
                        },
                        ticks: { 
                            color: textColor 
                        },
                        grid: { 
                            color: gridColor
                        }
                    }
                }
            };
        }
        
        // Function to render all charts
        function renderCharts() {
            // w(z) Chart with DESI data points
            const wzCtx = document.getElementById('WzChart').getContext('2d');
            if (wzChartInstance) wzChartInstance.destroy();
            
            // Find w(z=0.5) for annotation
            const z05Index = html_data.z.findIndex(z => Math.abs(z - 0.5) < 0.001);
            const wz05 = z05Index !== -1 ? html_data.w_z[z05Index] : -1.05;
            
            wzChartInstance = new Chart(wzCtx, {
                type: 'line',
                data: {
                    labels: html_data.z,
                    datasets: [
                        {
                            label: 'w(z) GDE-Modell',
                            data: html_data.w_z,
                            borderColor: '#5D5CDE',
                            backgroundColor: 'rgba(93, 92, 222, 0.1)',
                            borderWidth: 3,
                            fill: 'origin'
                        },
                        {
                            label: 'w(z) ΛCDM',
                            data: html_data.w_z_LCDM,
                            borderColor: '#10b981',
                            borderWidth: 2,
                            borderDash: [5, 5],
                            fill: false
                        },
                        {
                            label: 'DESI Messungen',
                            data: html_data.DESI_points.map(p => ({ x: p.z, y: p.w })),
                            borderColor: '#f97316',
                            backgroundColor: '#f97316',
                            pointRadius: 6,
                            pointHoverRadius: 8,
                            showLine: false
                        }
                    ]
                },
                options: {
                    ...getChartOptions('w(z) Dynamik mit DESI-Messungen', 'w(z)'),
                    plugins: {
                        ...getChartOptions().plugins,
                        tooltip: {
                            ...getChartOptions().plugins.tooltip,
                            callbacks: {
                                label: function(context) {
                                    if (context.datasetIndex === 2) { // DESI points
                                        const pointIndex = context.dataIndex;
                                        const label = html_data.DESI_points[pointIndex].label;
                                        return `${label}: ${context.parsed.y.toFixed(2)}`;
                                    }
                                    return `${context.dataset.label}: ${context.parsed.y.toFixed(3)}`;
                                }
                            }
                        },
                        annotation: {
                            annotations: {
                                line1: {
                                    type: 'line',
                                    xMin: -0.5,
                                    xMax: 3,
                                    yMin: -1,
                                    yMax: -1,
                                    borderColor: '#10b981',
                                    borderWidth: 1,
                                    borderDash: [5, 5]
                                },
                                valueAtZ05: {
                                    type: 'label',
                                    xValue: 0.5,
                                    yValue: wz05 - 0.07,
                                    content: [`w(0.5) = ${wz05.toFixed(2)}`],
                                    backgroundColor: 'rgba(93, 92, 222, 0.7)',
                                    font: {
                                        size: 12,
                                        weight: 'bold',
                                        color: 'white'
                                    },
                                    padding: {
                                        x: 6,
                                        y: 4
                                    },
                                    borderRadius: 4
                                },
                                phantomRegion: {
                                    type: 'box',
                                    xMin: -0.5,
                                    xMax: 3,
                                    yMin: -1.3,
                                    yMax: -1,
                                    backgroundColor: 'rgba(239, 68, 68, 0.1)',
                                    borderColor: 'rgba(239, 68, 68, 0)',
                                    borderWidth: 0,
                                },
                                phantomLabel: {
                                    type: 'label',
                                    xValue: 2.7,
                                    yValue: -1.08,
                                    content: 'Phantom-Bereich',
                                    color: '#ef4444',
                                    font: {
                                        size: 11,
                                        style: 'italic'
                                    }
                                },
                                quintessenceRegion: {
                                    type: 'box',
                                    xMin: -0.5,
                                    xMax: 3,
                                    yMin: -1,
                                    yMax: -0.7,
                                    backgroundColor: 'rgba(59, 130, 246, 0.1)',
                                    borderColor: 'rgba(59, 130, 246, 0)',
                                    borderWidth: 0,
                                },
                                quintessenceLabel: {
                                    type: 'label',
                                    xValue: 2.7,
                                    yValue: -0.9,
                                    content: 'Quintessenz-Bereich',
                                    color: '#3b82f6',
                                    font: {
                                        size: 11,
                                        style: 'italic'
                                    }
                                }
                            }
                        }
                    },
                    scales: {
                        ...getChartOptions().scales,
                        y: {
                            ...getChartOptions().scales.y,
                            min: -1.3,
                            max: -0.7
                        }
                    }
                }
            });

            // Lambda(z) Chart
            const lambdaMainCtx = document.getElementById('LambdaMainChart').getContext('2d');
            if (lambdaMainChartInstance) lambdaMainChartInstance.destroy();
            
            lambdaMainChartInstance = new Chart(lambdaMainCtx, {
                type: 'line',
                data: {
                    labels: html_data.z,
                    datasets: [
                        {
                            label: 'Λ(z)/Λ₀ GDE-Modell',
                            data: html_data.Lambda_ratio,
                            borderColor: '#5D5CDE',
                            backgroundColor: 'rgba(93, 92, 222, 0.1)',
                            borderWidth: 3,
                            fill: true
                        },
                        {
                            label: 'Λ ΛCDM-Modell (konstant)',
                            data: html_data.Lambda_LCDM,
                            borderColor: '#10b981',
                            borderWidth: 2,
                            borderDash: [5, 5],
                            fill: false
                        }
                    ]
                },
                options: {
                    ...getChartOptions('Lambda-Term Λ(z)/Λ₀', 'Λ(z)/Λ₀'),
                    plugins: {
                        ...getChartOptions().plugins,
                        annotation: {
                            annotations: {
                                zStarLine: {
                                    type: 'line',
                                    xMin: modelParams.z_star,
                                    xMax: modelParams.z_star,
                                    yMin: 0.5,
                                    yMax: 1.5,
                                    borderColor: 'rgba(93, 92, 222, 0.6)',
                                    borderWidth: 2,
                                    borderDash: [6, 4]
                                },
                                zStarLabel: {
                                    type: 'label',
                                    xValue: modelParams.z_star,
                                    yValue: 1.4,
                                    content: [`z* = ${modelParams.z_star.toFixed(2)}`],
                                    backgroundColor: 'rgba(93, 92, 222, 0.7)',
                                    font: {
                                        size: 12,
                                        weight: 'bold',
                                        color: 'white'
                                    },
                                    padding: {
                                        x: 6,
                                        y: 4
                                    },
                                    borderRadius: 4
                                },
                                z05Line: {
                                    type: 'line',
                                    xMin: 0.5,
                                    xMax: 0.5,
                                    yMin: 0.7,
                                    yMax: 1.3, 
                                    borderColor: 'rgba(249, 115, 22, 0.7)',
                                    borderWidth: 2,
                                    borderDash: [6, 4]
                                },
                                z05Label: {
                                    type: 'label',
                                    xValue: 0.5,
                                    yValue: 0.75,
                                    content: ['DESI-Messung (z=0.5)'],
                                    backgroundColor: 'rgba(249, 115, 22, 0.7)', 
                                    font: {
                                        size: 12,
                                        weight: 'bold',
                                        color: 'white'
                                    },
                                    padding: {
                                        x: 6,
                                        y: 4
                                    },
                                    borderRadius: 4
                                }
                            }
                        }
                    }
                }
            });
            
            // Compare w(z) fits chart
            const compareFitsCtx = document.getElementById('CompareFitsChart').getContext('2d');
            if (compareFitsChartInstance) compareFitsChartInstance.destroy();
            
            compareFitsChartInstance = new Chart(compareFitsCtx, {
                type: 'line',
                data: {
                    labels: html_data.z,
                    datasets: [
                        {
                            label: 'GDE-Modell',
                            data: html_data.w_z,
                            borderColor: '#5D5CDE',
                            backgroundColor: 'transparent',
                            borderWidth: 3,
                            fill: false
                        },
                        {
                            label: 'DESI+PantheonPlus',
                            data: html_data.w_z_pantheon,
                            borderColor: '#ef4444',
                            backgroundColor: 'transparent',
                            borderWidth: 2,
                            borderDash: [3, 2],
                            fill: false
                        },
                        {
                            label: 'DESI+Union3',
                            data: html_data.w_z_union3,
                            borderColor: '#f97316',
                            backgroundColor: 'transparent',
                            borderWidth: 2,
                            borderDash: [3, 2],
                            fill: false
                        },
                        {
                            label: 'DESI+DESY5',
                            data: html_data.w_z_desy5,
                            borderColor: '#eab308',
                            backgroundColor: 'transparent',
                            borderWidth: 2,
                            borderDash: [3, 2], 
                            fill: false
                        },
                        {
                            label: 'ΛCDM',
                            data: html_data.w_z_LCDM,
                            borderColor: '#10b981',
                            backgroundColor: 'transparent',
                            borderWidth: 2,
                            borderDash: [5, 5],
                            fill: false
                        }
                    ]
                },
                options: {
                    ...getChartOptions('Vergleich mit DESI-Fits', 'w(z)'),
                    scales: {
                        ...getChartOptions().scales,
                        y: {
                            ...getChartOptions().scales.y,
                            min: -1.3,
                            max: -0.5
                        },
                        x: {
                            ...getChartOptions().scales.x,
                            min: -0.2,
                            max: 2.0
                        }
                    },
                    plugins: {
                        ...getChartOptions().plugins,
                        annotation: {
                            annotations: {
                                z05Line: {
                                    type: 'line',
                                    xMin: 0.5,
                                    xMax: 0.5,
                                    yMin: -1.3,
                                    yMax: -0.5,
                                    borderColor: 'rgba(107, 114, 128, 0.4)',
                                    borderWidth: 1,
                                    borderDash: [6, 4]
                                },
                                z05Label: {
                                    type: 'label',
                                    xValue: 0.5,
                                    yValue: -0.6,
                                    content: ['z=0.5'],
                                    font: {
                                        size: 11,
                                        weight: 'bold'
                                    },
                                    color: 'rgba(107, 114, 128, 0.8)',
                                    padding: {
                                        x: 4,
                                        y: 2
                                    }
                                },
                                line1: {
                                    type: 'line',
                                    xMin: -0.2,
                                    xMax: 2.0,
                                    yMin: -1,
                                    yMax: -1,
                                    borderColor: 'rgba(16, 185, 129, 0.4)',
                                    borderWidth: 1,
                                    borderDash: [6, 4]
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // Set up interactive parameter controls
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize sliders
            const z_starSlider = document.getElementById('z_star');
            const z_starValue = document.getElementById('z_star_value');
            const alpha_0Slider = document.getElementById('alpha_0');
            const alpha_0Value = document.getElementById('alpha_0_value');
            const alpha_ampSlider = document.getElementById('alpha_amp');
            const alpha_ampValue = document.getElementById('alpha_amp_value');
            const betaSlider = document.getElementById('beta');
            const betaValue = document.getElementById('beta_value');
            const resetButton = document.getElementById('resetParams');
            
            if (z_starSlider) {
                z_starSlider.addEventListener('input', function(e) {
                    const value = parseFloat(e.target.value);
                    z_starValue.textContent = `z* = ${value.toFixed(2)}`;
                    modelParams.z_star = value;
                    recomputeData();
                });
            }
            
            if (alpha_0Slider) {
                alpha_0Slider.addEventListener('input', function(e) {
                    const value = parseFloat(e.target.value);
                    alpha_0Value.textContent = `α₀ = ${value.toFixed(2)}`;
                    modelParams.alpha_0 = value;
                    recomputeData();
                });
            }
            
            if (alpha_ampSlider) {
                alpha_ampSlider.addEventListener('input', function(e) {
                    const value = parseFloat(e.target.value);
                    alpha_ampValue.textContent = `A = ${value.toFixed(2)}`;
                    modelParams.alpha_amp = value;
                    recomputeData();
                });
            }
            
            if (betaSlider) {
                betaSlider.addEventListener('input', function(e) {
                    const value = parseFloat(e.target.value);
                    betaValue.textContent = `β = ${value.toFixed(3)}`;
                    modelParams.beta = value;
                    recomputeData();
                });
            }
            
            if (resetButton) {
                resetButton.addEventListener('click', function() {
                    // Reset to optimal values for DESI fits
                    modelParams = {
                        z_star: 0.70,
                        alpha_0: -0.65,
                        alpha_amp: 1.10,
                        beta: 0.040
                    };
                    
                    // Update slider positions and values
                    if (z_starSlider) {
                        z_starSlider.value = modelParams.z_star;
                        z_starValue.textContent = `z* = ${modelParams.z_star.toFixed(2)}`;
                    }
                    
                    if (alpha_0Slider) {
                        alpha_0Slider.value = modelParams.alpha_0;
                        alpha_0Value.textContent = `α₀ = ${modelParams.alpha_0.toFixed(2)}`;
                    }
                    
                    if (alpha_ampSlider) {
                        alpha_ampSlider.value = modelParams.alpha_amp;
                        alpha_ampValue.textContent = `A = ${modelParams.alpha_amp.toFixed(2)}`;
                    }
                    
                    if (betaSlider) {
                        betaSlider.value = modelParams.beta;
                        betaValue.textContent = `β = ${modelParams.beta.toFixed(3)}`;
                    }
                    
                    // Recompute data and redraw charts
                    recomputeData();
                });
            }
            
            // Dark mode toggle
            const darkModeToggle = document.getElementById('darkModeToggle');
            const darkModeIcon = document.getElementById('darkModeIcon');
            const darkModeText = document.getElementById('darkModeText');
            
            function updateDarkModeUI() {
                if (document.documentElement.classList.contains('dark')) {
                    darkModeIcon.textContent = '☀️';
                    darkModeText.textContent = 'Light Mode';
                } else {
                    darkModeIcon.textContent = '🌙';
                    darkModeText.textContent = 'Dark Mode';
                }
            }
            
            function toggleDarkMode() {
                if (document.documentElement.classList.contains('dark')) {
                    document.documentElement.classList.remove('dark');
                } else {
                    document.documentElement.classList.add('dark');
                }
                
                updateDarkModeUI();
                renderCharts();
            }
            
            if (darkModeToggle) {
                darkModeToggle.addEventListener('click', toggleDarkMode);
                updateDarkModeUI();
            }
            
            // Set generation date
            document.getElementById('generationDate').textContent = `Daten generiert am: ${new Date().toLocaleDateString('de-DE')}`;
            
            // Loading indicator
            const loadingBar = document.getElementById('loading-bar');
            function updateLoadingBar(percent) {
                loadingBar.style.width = `${percent}%`;
                if (percent >= 100) {
                    setTimeout(() => {
                        loadingBar.style.width = '0%';
                    }, 300);
                }
            }
            
            // Simulate loading progress
            let progress = 0;
            const loadingInterval = setInterval(() => {
                progress += 5;
                updateLoadingBar(progress);
                if (progress >= 100) {
                    clearInterval(loadingInterval);
                }
            }, 50);
            
            // Initialize Chart.js plugins
            Chart.register({
                id: 'annotation',
                beforeDraw: (chart) => {
                    const ctx = chart.ctx;
                    const annotations = chart.options.plugins?.annotation?.annotations;
                    
                    if (!annotations) return;
                    
                    Object.values(annotations).forEach(annotation => {
                        if (annotation.type === 'box') {
                            const { xMin, xMax, yMin, yMax } = annotation;
                            const scales = chart.scales;
                            
                            if (!scales.x || !scales.y) return;
                            
                            const x0 = scales.x.getPixelForValue(xMin);
                            const x1 = scales.x.getPixelForValue(xMax);
                            const y0 = scales.y.getPixelForValue(yMin);
                            const y1 = scales.y.getPixelForValue(yMax);
                            
                            ctx.save();
                            ctx.fillStyle = annotation.backgroundColor || 'rgba(0,0,0,0.1)';
                            ctx.fillRect(x0, y1, x1 - x0, y0 - y1);
                            
                            if (annotation.borderWidth > 0) {
                                ctx.strokeStyle = annotation.borderColor || 'rgba(0,0,0,0.1)';
                                ctx.lineWidth = annotation.borderWidth;
                                ctx.strokeRect(x0, y1, x1 - x0, y0 - y1);
                            }
                            
                            ctx.restore();
                        } else if (annotation.type === 'line') {
                            const { xMin, xMax, yMin, yMax } = annotation;
                            const scales = chart.scales;
                            
                            if (!scales.x || !scales.y) return;
                            
                            let x0, x1, y0, y1;
                            
                            if (xMin !== undefined && xMax !== undefined) {
                                // Horizontal line
                                x0 = scales.x.getPixelForValue(xMin);
                                x1 = scales.x.getPixelForValue(xMax);
                                y0 = y1 = scales.y.getPixelForValue(yMin);
                            } else {
                                // Vertical line
                                x0 = x1 = scales.x.getPixelForValue(xMin);
                                y0 = scales.y.getPixelForValue(yMin);
                                y1 = scales.y.getPixelForValue(yMax);
                            }
                            
                            ctx.save();
                            ctx.beginPath();
                            ctx.moveTo(x0, y0);
                            ctx.lineTo(x1, y1);
                            ctx.strokeStyle = annotation.borderColor || 'rgba(0,0,0,0.1)';
                            ctx.lineWidth = annotation.borderWidth || 1;
                            
                            if (annotation.borderDash) {
                                ctx.setLineDash(annotation.borderDash);
                            }
                            
                            ctx.stroke();
                            ctx.restore();
                        } else if (annotation.type === 'label') {
                            const { xValue, yValue, content } = annotation;
                            const scales = chart.scales;
                            
                            if (!scales.x || !scales.y || !content) return;
                            
                            const x = scales.x.getPixelForValue(xValue);
                            const y = scales.y.getPixelForValue(yValue);
                            
                            ctx.save();
                            
                            // Background
                            if (annotation.backgroundColor) {
                                const textLines = Array.isArray(content) ? content : [content];
                                const fontSize = annotation.font?.size || 12;
                                const padding = annotation.padding || { x: 6, y: 4 };
                                const lineHeight = fontSize * 1.2;
                                const textWidth = Math.max(...textLines.map(line => ctx.measureText(line).width));
                                const width = textWidth + padding.x * 2;
                                const height = textLines.length * lineHeight + padding.y * 2;
                                
                                ctx.fillStyle = annotation.backgroundColor;
                                
                                if (annotation.borderRadius) {
                                    const radius = annotation.borderRadius;
                                    ctx.beginPath();
                                    ctx.moveTo(x - width/2 + radius, y - height/2);
                                    ctx.lineTo(x + width/2 - radius, y - height/2);
                                    ctx.quadraticCurveTo(x + width/2, y - height/2, x + width/2, y - height/2 + radius);
                                    ctx.lineTo(x + width/2, y + height/2 - radius);
                                    ctx.quadraticCurveTo(x + width/2, y + height/2, x + width/2 - radius, y + height/2);
                                    ctx.lineTo(x - width/2 + radius, y + height/2);
                                    ctx.quadraticCurveTo(x - width/2, y + height/2, x - width/2, y + height/2 - radius);
                                    ctx.lineTo(x - width/2, y - height/2 + radius);
                                    ctx.quadraticCurveTo(x - width/2, y - height/2, x - width/2 + radius, y - height/2);
                                    ctx.closePath();
                                    ctx.fill();
                                } else {
                                    ctx.fillRect(x - width/2, y - height/2, width, height);
                                }
                            }
                            
                            // Text
                            ctx.textAlign = 'center';
                            ctx.textBaseline = 'middle';
                            ctx.fillStyle = annotation.font?.color || annotation.color || '#000000';
                            ctx.font = `${annotation.font?.style || ''} ${annotation.font?.weight || ''} ${annotation.font?.size || 12}px sans-serif`;
                            
                            const textLines = Array.isArray(content) ? content : [content];
                            const lineHeight = (annotation.font?.size || 12) * 1.2;
                            const totalHeight = textLines.length * lineHeight;
                            
                            textLines.forEach((line, i) => {
                                const offsetY = (i - (textLines.length-1)/2) * lineHeight;
                                ctx.fillText(line, x, y + offsetY);
                            });
                            
                            ctx.restore();
                        }
                    });
                }
            });
            
            // Initial render
            renderCharts();
        });
        
        // MathJax configuration
        window.MathJax = {
            tex: {
                inlineMath: [['\\(', '\\)']],
                displayMath: [['\\[', '\\]']]
            },
            startup: {
                ready: () => {
                    MathJax.startup.defaultReady();
                    setTimeout(renderCharts, 200);
                }
            }
        };
    </script>
</body>
</html>
